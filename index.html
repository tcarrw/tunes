<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Tunes · Illumina 1 Playlist (Public)</title>
<meta name="theme-color" content="#0B0F19">
<meta name="description" content="Illumina 1 public playlist. YouTube canonical; Apple Music and Spotify mirrors coming soon.">
<style>
  :root{
    --bg:#0B0F19;--ink:#E5E7EB;--muted:#9CA3AF;--line:rgba(229,231,235,.15);
    --gold:#F5D142;--amber:#F59E0B;--ok:#34D399;--warn:#FBBF24;--err:#F87171;
    --r:14px;--pad:18px;--maxw:1100px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.55 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  a{color:var(--gold);text-decoration:none}
  a:hover{text-decoration:underline}
  .wrap{max-width:var(--maxw);margin:0 auto;padding:clamp(14px,3.5vw,28px)}
  header{display:grid;gap:8px;margin:6px 0 18px}
  h1{margin:0;font-size:clamp(22px,4.5vw,34px);line-height:1.2}
  .muted{color:var(--muted)}
  .bar{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
  .pill{border:1px solid var(--line);border-radius:999px;padding:6px 10px;color:var(--muted);font-size:13px}
  .btn{border:1px solid var(--line);border-radius:999px;padding:8px 12px;background:rgba(255,255,255,.02);color:var(--ink)}
  .btn.primary{border-color:var(--amber);background:linear-gradient(180deg,rgba(245,209,66,.15),rgba(245,158,11,.12))}
  input[type="text"], select{
    padding:10px 12px;border:1px solid var(--line);border-radius:999px;background:rgba(255,255,255,.02);color:var(--ink);font:inherit;
  }
  .grid{display:grid;gap:12px}
  .cards{grid-template-columns:1fr}
  @media (min-width:840px){.cards{grid-template-columns:1fr 1fr}}
  .card{border:1px solid var(--line);border-radius:var(--r);padding:var(--pad);background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(255,255,255,0))}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
  .tag{font-size:12px;color:#cfd3db;border:1px dashed var(--line);border-radius:8px;padding:2px 8px}
  .title{font-size:17px;font-weight:700;line-height:1.25}
  .artist{opacity:.9}
  .meta{display:grid;gap:8px;margin-top:8px}
  .platforms{display:flex;gap:8px;flex-wrap:wrap;margin-top:6px}
  .play{display:inline-flex;align-items:center;gap:8px;border:1px solid var(--line);border-radius:10px;padding:8px 12px;background:rgba(255,255,255,.03)}
  .badge{font-size:12px;color:var(--muted);border:1px solid var(--line);border-radius:999px;padding:4px 8px}
  .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
  footer{margin:24px 0 8px;color:var(--muted);font-size:13px;text-align:center}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Illumina 1 — Public Playlist</h1>
    <div class="bar">
      <span id="cycle" class="pill">Loading…</span>
      <label class="pill" for="search">Search</label>
      <input id="search" type="text" placeholder="Title, artist, figure…">
      <select id="dayJump" aria-label="Jump to day"><option value="">Jump to day…</option></select>
      <button id="toggleMissing" class="btn" type="button">Show only missing YouTube</button>
      <button id="reload" class="btn" type="button">Reload</button>
      <span id="stat" class="pill">—</span>
    </div>
    <p class="muted">YouTube is the canonical public playlist. Apple Music / Spotify mirrors coming soon.</p>
  </header>

  <section id="cards" class="grid cards" aria-live="polite"></section>

  <footer>
    <p>PLNT Earth · Illumina — Tunes</p>
    <p class="muted">Source JSON: <span class="mono" id="srcLabel">/Illumina1_Playlist_YT_Apple_Spotify.json</span></p>
  </footer>
</div>

<script>
(function(){
  var q = new URLSearchParams(location.search);
  var src = q.get('src') || '/Illumina1_Playlist_YT_Apple_Spotify.json';
  var data = null, filtered = false, term = '';
  var elCards = document.getElementById('cards');
  var elCycle = document.getElementById('cycle');
  var elStat = document.getElementById('stat');
  var elSearch = document.getElementById('search');
  var elMissing = document.getElementById('toggleMissing');
  var elReload = document.getElementById('reload');
  var elDayJump = document.getElementById('dayJump');
  var elSrcLabel = document.getElementById('srcLabel');
  elSrcLabel.textContent = src;

  function setStat(t){ elStat.textContent = t; }
  function safe(v){ return v==null ? "" : String(v); }
  function hasYouTube(it){
    return !!(it.Platforms && it.Platforms.YouTube && it.Platforms.YouTube.url);
  }
  function validYT(u){
    if(!u) return false;
    var s = String(u).trim();
    if(!/^https?:\/\//i.test(s)) return false;
    if(!/youtube\.com|youtu\.be/i.test(s)) return false;
    return true;
  }
  function match(it){
    if(!term) return true;
    var t = term.toLowerCase();
    return (
      safe(it.Track && it.Track.title).toLowerCase().indexOf(t)>-1 ||
      safe(it.Track && it.Track.artist).toLowerCase().indexOf(t)>-1 ||
      safe(it.Figure).toLowerCase().indexOf(t)>-1 ||
      safe(it.SeedRitual).toLowerCase().indexOf(t)>-1
    );
  }

  function render(){
    if(!data || !data.Playlist){ elCards.innerHTML=''; elCycle.textContent='No data'; return; }
    var list = data.Playlist.slice();
    var total = list.length;
    var missing = 0, warn = 0, ok = 0;

    var rows = [];
    for(var i=0;i<list.length;i++){
      var it = list[i];
      if(filtered && hasYouTube(it)) continue;
      if(!match(it)) continue;

      var d = safe(it.Day), date = safe(it.Date);
      var title = safe(it.Track && it.Track.title);
      var artist = safe(it.Track && it.Track.artist);
      var fig = safe(it.Figure);
      var seed = safe(it.SeedRitual);
      var yt = safe(it.Platforms && it.Platforms.YouTube && it.Platforms.YouTube.url);
      var ytOk = validYT(yt);
      if(!yt) missing++; else if(ytOk) ok++; else warn++;

      rows.push(
        '<article class="card" id="day-'+d+'">'+
          '<div class="row"><span class="tag">Day '+d+'</span><span class="tag mono">'+date+'</span></div>'+
          '<div class="meta">'+
            '<div class="title">'+title+'</div>'+
            '<div class="artist">'+artist+'</div>'+
            (fig?'<div class="muted">Figure: '+fig+'</div>':'')+
            (seed?'<div class="muted">Seed: '+seed+'</div>':'')+
            '<div class="platforms">'+
              (yt ? '<a class="play" href="'+yt+'" target="_blank" rel="noopener">▶︎ Play on YouTube</a>' :
                    '<span class="badge err">YouTube link missing</span>')+
              '<span class="badge">Apple Music: coming soon</span>'+
              '<span class="badge">Spotify: coming soon</span>'+
            '</div>'+
            (yt && !ytOk ? '<div class="warn">Please check this YouTube URL.</div>' : '')+
          '</div>'+
        '</article>'
      );
    }
    elCards.innerHTML = rows.join('');
    var start = data.Cycle && data.Cycle.Start ? data.Cycle.Start : '—';
    var end = data.Cycle && data.Cycle.End ? data.Cycle.End : '—';
    elCycle.textContent = 'Cycle: '+start+' → '+end+' · Days: '+total;
    setStat('OK: '+ok+' · Missing: '+missing+' · Check: '+warn);
  }

  function buildDayJump(){
    if(!data || !data.Playlist) return;
    var opts = ['<option value="">Jump to day…</option>'];
    for(var i=0;i<data.Playlist.length;i++){
      var d = data.Playlist[i].Day || (i+1);
      opts.push('<option value="'+d+'">Day '+d+'</option>');
    }
    elDayJump.innerHTML = opts.join('');
  }

  function jumpTo(day){
    var el = document.getElementById('day-'+day);
    if(!el) return;
    el.scrollIntoView({behavior:'smooth', block:'start'});
  }

  function load(){
    setStat('Loading…');
    fetch(src, {cache:'no-store'}).then(function(r){
      if(!r.ok) throw new Error('Load failed');
      return r.json();
    }).then(function(json){
      data = json;
      buildDayJump();
      render();
      setStat('Loaded');
    }).catch(function(){
      setStat('Could not load JSON');
      elCards.innerHTML = '';
      elCycle.textContent = 'Load error';
    });
  }

  elSearch.addEventListener('input', function(){ term = this.value.trim(); render(); });
  elMissing.addEventListener('click', function(){
    filtered = !filtered;
    this.textContent = filtered ? 'Show all' : 'Show only missing YouTube';
    render();
  });
  elReload.addEventListener('click', load);
  elDayJump.addEventListener('change', function(){ if(this.value) jumpTo(this.value); });

  load();
})();
</script>
</body>
</html>
