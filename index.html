<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tunes ‚Äî Archetype Playlists ¬∑ Pro CTA Edition</title>
<meta name="theme-color" content="#0b0d11">
<meta name="description" content="Tunes ‚Äî Archetype Playlists for Illumina. Root (Ground), Architect (Focus), Mirror (Reflect). No Kings Day CTA + live ET countdown. Shared ProAudio Honey 128‚ÄØHz bed." />
<style>
  :root{
    color-scheme: dark;
    --bg:#0b0d11; --ink:#e7edf7; --muted:#a9b4c7; --edge:#1e2430; --ring:#2c3444;
    --panel:#101423; --accent:#a4ff65; --sky:#86c9ff; --rose:#ff6a9e; --honey:#ffd166;
    --ctaGlow:rgba(142,239,255,.18);
  }
  html,body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 ui-sans-serif,system-ui,-apple-system,"SF Pro Text",Segoe UI,Roboto,Helvetica,Arial;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility}
  *{box-sizing:border-box}
  :focus-visible{outline:2px solid var(--sky);outline-offset:2px}

  .cta{
    position:sticky; top:0; z-index:10000; display:flex; gap:10px; align-items:center; flex-wrap:wrap; justify-content:space-between;
    padding:10px 12px;
    background:
      linear-gradient(180deg, rgba(255,255,255,.04), rgba(0,0,0,.12)) padding-box,
      linear-gradient(120deg, rgba(134,201,255,.35), rgba(164,255,101,.30)) border-box;
    border:1px solid transparent; border-bottom-color:rgba(255,255,255,.14);
    box-shadow:0 10px 28px rgba(0,0,0,.35); backdrop-filter: blur(6px)
  }
  .badges{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .badge{
    display:inline-flex;align-items:center;gap:8px;padding:7px 10px;border-radius:999px;
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.10));
    border:1px solid rgba(255,255,255,.16);font-weight:800;white-space:nowrap
  }
  .count{display:inline-flex;gap:8px;align-items:center;font-variant-numeric:tabular-nums;letter-spacing:.2px}
  .count b{font-size:1.02rem}
  .right{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .btn{
    appearance:none;border:1px solid var(--edge);border-radius:12px;cursor:pointer;
    background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(0,0,0,.06)),var(--panel);color:var(--ink);
    padding:9px 12px;font-weight:750;text-decoration:none;display:inline-flex;align-items:center;gap:8px
  }
  .btn:hover{border-color:var(--ring);box-shadow:0 0 0 2px var(--ctaGlow)}
  .btn.primary{border-color:#2f4a2f;background:linear-gradient(180deg, rgba(164,255,101,.18), rgba(0,0,0,.06))}

  .wrap{max-width:1080px;margin:0 auto;padding:18px 16px 96px;position:relative;z-index:1}
  header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin-bottom:12px}
  h1{margin:0;font-size:clamp(20px,3.6vw,32px)}
  .sub{color:var(--muted);font-size:.96rem}
  .actions{display:flex;gap:8px;flex-wrap:wrap}

  .grid{display:grid;grid-template-columns:1fr;gap:14px}
  .card{border:1px solid var(--edge);border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.02),rgba(0,0,0,.06));padding:14px}
  .title{display:flex;align-items:center;justify-content:space-between;gap:10px}
  .title h2{margin:0;font-size:1.05rem;letter-spacing:.2px}
  .hue{height:6px;border-radius:999px;background:linear-gradient(90deg,var(--c1),var(--c2));box-shadow:0 0 0 1px rgba(255,255,255,.06) inset}
  .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--edge);border-radius:999px;color:var(--muted);font-size:.88rem}
  .note{color:var(--muted);font-size:.95rem}
  .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
  .small{font-size:.92rem;color:var(--muted)}

  .bee{
    margin-top:12px;border:1px solid rgba(255,255,255,.16);border-radius:16px;padding:14px;
    background:linear-gradient(180deg, rgba(255,206,84,.10), rgba(0,0,0,.03)) padding-box,
               linear-gradient(120deg, rgba(255,206,84,.35), rgba(255,111,186,.30), rgba(134,201,255,.30)) border-box;
    position:relative;
  }
  .bee-head{display:flex;align-items:center;gap:8px;font-weight:800;letter-spacing:.2px}
  .bee-soft{color:var(--muted);font-weight:600}
  .bee p{margin:8px 0 10px}
  .bee-tools{display:flex;gap:8px;flex-wrap:wrap}
  .bee-btn{appearance:none;border:1px solid rgba(255,255,255,.14);border-radius:10px;background:rgba(255,255,255,.06);color:#fff;font-weight:800;padding:8px 10px;cursor:pointer}
  .bee-btn:hover{border-color:rgba(255,255,255,.22);box-shadow:0 0 0 2px rgba(255,206,84,.18)}
  .bee-footer{
    position:fixed;left:50%;transform:translateX(-50%);bottom:14px;z-index:9999;display:none;align-items:center;gap:8px;
    padding:10px 14px;border-radius:999px;background:linear-gradient(180deg, rgba(255,206,84,.14), rgba(0,0,0,.14)) padding-box,
    linear-gradient(120deg, rgba(255,206,84,.6), rgba(255,111,186,.45), rgba(134,201,255,.45)) border-box;border:1px solid transparent;color:#fff;font-weight:700;box-shadow:0 12px 28px rgba(0,0,0,.35);backdrop-filter:blur(6px);max-width:90vw;text-align:center
  }
  .bee-footer.on{display:inline-flex}

  .range{appearance:none;width:180px;height:4px;border-radius:999px;background:#1a2332;outline:none}
  .range::-webkit-slider-thumb{appearance:none;width:18px;height:18px;border-radius:50%;background:#fff;border:2px solid #000}

  .pillToggle{
    position:fixed; right:14px; bottom:16px; z-index:10001; border-radius:999px;
    display:inline-flex; align-items:center; gap:8px; padding:9px 12px; font-weight:800;
    border:1px solid rgba(255,255,255,.16);
    background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(0,0,0,.12));
    color:#fff; text-decoration:none; box-shadow:0 10px 30px rgba(0,0,0,.38)
  }
  .pillToggle[aria-pressed="true"]{ border-color:#3a5f44; background:linear-gradient(180deg,rgba(164,255,101,.22),rgba(0,0,0,.10)) }
</style>
</head>
<body>
  <div class="cta" role="banner" aria-label="No Kings Day actions">
    <div class="badges">
      <span class="badge">üóìÔ∏è No Kings Day ¬∑ Oct 18 ¬∑ NYC</span>
      <span class="badge">üé§ Call: Marina √ó Sabrina √ó Doechii on SNL</span>
      <span class="badge count" id="countWrap" aria-live="polite"><span>‚è≥</span><b id="countTxt">‚Äî</b></span>
    </div>
    <div class="right" role="toolbar" aria-label="Share and join">
      <a id="shareX" class="btn" href="#" target="_blank" rel="noopener" aria-label="Share this page on X">Share on X</a>
      <a id="ics" class="btn" download="no-kings-day.ics" href="#" aria-label="Add No Kings Day to your calendar">Add to Calendar</a>
      <a class="btn primary" href="https://jar.plnt.earth" aria-label="Join in NYC via Jar">Join in NYC ‚Üí Jar</a>
    </div>
  </div>

  <div class="wrap">
    <header>
      <div>
        <h1>Tunes ‚Äî <span style="opacity:.9">Archetype Playlists</span></h1>
        <div class="sub">Three gentle lanes: <b>ROOT</b> (Ground), <b>ARCHITECT</b> (Focus), <b>MIRROR</b> (Reflect). Honey 128‚ÄØHz is one tap away; use softly. Color‚Äëbreath lives in <b>Froot</b> and rituals in <b>Rooms</b>.</div>
        <div class="row" style="margin-top:8px">
          <a class="pill" href="#root">ROOT</a>
          <a class="pill" href="#architect">ARCHITECT</a>
          <a class="pill" href="#mirror">MIRROR</a>
        </div>
      </div>
      <nav class="actions" aria-label="Navigation">
        <a class="btn" href="https://froot.plnt.earth">‚Ü™ Froot Studio</a>
        <a class="btn" href="https://jar.plnt.earth/school.html">School</a>
        <a class="btn" href="https://jar.plnt.earth/school-rooms.html">Rooms</a>
        <a class="btn" href="https://jar.plnt.earth/marina-egg.html">‚Ü© Egg</a>
      </nav>
    </header>

    <section id="ask" class="card">
      <div class="title"><h2>Ask</h2><div class="hue" style="--c1:#0f1e33;--c2:#86c9ff" aria-hidden="true"></div></div>
      <p>No Kings Day ‚Äî <b>Oct 18, NYC</b>. <b>Marina √ó Sabrina √ó Doechii</b> on SNL. Join us.</p>
      <div class="controls">
        <a class="btn primary" href="https://jar.plnt.earth">Join in NYC ‚Üí Jar</a>
        <a class="btn" href="#honeyCard">Start Honey 128‚ÄØHz</a>
        <a class="btn" href="https://jar.plnt.earth/school-rooms.html#honey">Flame Check</a>
      </div>
    </section>

    <section id="bee" class="bee" role="note" aria-live="polite">
      <div class="bee-head"><span>üêù</span><span><strong>Bee Note to Sabrina</strong></span> <span class="bee-soft">Choose the lane that feels kind right now.</span></div>
      <p id="bee-text"></p>
      <div class="bee-tools">
        <button type="button" class="bee-btn" id="beeEdit">Edit</button>
        <button type="button" class="bee-btn" id="beeSave">Save</button>
        <button type="button" class="bee-btn" id="beeReset">Reset</button>
      </div>
    </section>

    <section id="honeyCard" class="card">
      <div class="title"><h2>üçØ Honey ‚Äî 128‚ÄØHz Warm Bed</h2><div class="hue" style="--c1:#3a2a0f;--c2:#f7d77a" aria-hidden="true"></div></div>
      <div class="note">A low, steady bed to layer under any playlist. Keep volume soft, like lamplight.</div>
      <div class="controls" role="group" aria-label="Honey controls">
        <button id="hStart" class="btn" type="button">Play 128‚ÄØHz</button>
        <button id="hStop" class="btn" type="button">Stop</button>
        <label class="pill">Volume <input id="hVol" class="range" type="range" min="0" max="100" value="28" aria-label="Honey volume (0‚Äì100)"></label>
      </div>
    </section>

    <section id="root" class="card" style="scroll-margin-top:84px">
      <div class="title"><h2>ROOT ‚Äî Ground</h2><div class="hue" style="--c1:#103018;--c2:#a4ff65" aria-hidden="true"></div></div>
      <div class="note">Arrival & safety. Slow tones around C3 with a long exhale. Honey pairs well.</div>
      <div class="controls">
        <button class="btn" type="button" data-play="root">Play</button>
        <button class="btn" type="button" data-stop>Stop</button>
        <span class="pill">Tempo <input id="tempo-root" class="range" type="range" min="0.5" max="1.5" step="0.05" value="1" aria-label="Root tempo"></span>
        <span class="small" id="status-root">‚Äî</span>
      </div>
    </section>

    <section id="architect" class="card" style="scroll-margin-top:84px">
      <div class="title"><h2>ARCHITECT ‚Äî Focus</h2><div class="hue" style="--c1:#0f1e33;--c2:#86c9ff" aria-hidden="true"></div></div>
      <div class="note">Gentle, structured pulses in the mid band (E4‚ÄìA4). A clear grid, no rush.</div>
      <div class="controls">
        <button class="btn" type="button" data-play="architect">Play</button>
        <button class="btn" type="button" data-stop>Stop</button>
        <span class="pill">Tempo <input id="tempo-architect" class="range" type="range" min="0.5" max="1.5" step="0.05" value="1" aria-label="Architect tempo"></span>
        <span class="small" id="status-architect">‚Äî</span>
      </div>
    </section>

    <section id="mirror" class="card" style="scroll-margin-top:84px">
      <div class="title"><h2>MIRROR ‚Äî Reflect</h2><div class="hue" style="--c1:#1b1030;--c2:#b38bff" aria-hidden="true"></div></div>
      <div class="note">Air and space. Higher, sparse tones with long rests ‚Äî built for journaling.</div>
      <div class="controls">
        <button class="btn" type="button" data-play="mirror">Play</button>
        <button class="btn" type="button" data-stop>Stop</button>
        <span class="pill">Tempo <input id="tempo-mirror" class="range" type="range" min="0.5" max="1.5" step="0.05" value="1" aria-label="Mirror tempo"></span>
        <span class="small" id="status-mirror">‚Äî</span>
      </div>
    </section>

    <section id="wtdn" class="card">
      <div class="title"><h2>What to do now</h2><div class="hue" style="--c1:#0f1e33;--c2:#86c9ff" aria-hidden="true"></div></div>
      <ol class="small" style="margin-top:6px">
        <li><b>Listen</b> ‚Äî start <em>Honey 128‚ÄØHz</em> or a playlist (Root/Architect/Mirror).</li>
        <li><b>Breathe</b> ‚Äî keep it soft; match a simple rhythm.</li>
        <li><b>Share / Arrive</b> ‚Äî use the ribbon to <em>Share on X</em>, <em>Add to Calendar</em>, or <em>Join in NYC</em>.</li>
      </ol>
      <div class="controls">
        <a class="btn primary" href="https://jar.plnt.earth">Join in NYC ‚Üí Jar</a>
        <a class="btn" href="https://froot.plnt.earth">Froot ‚Äî Color‚ÄëBreath</a>
        <a class="btn" href="https://jar.plnt.earth/school-rooms.html#honey">Flame Check</a>
      </div>
    </section>

    <footer class="small" style="margin-top:14px">If you feel full, pause. Quiet is music too. ‚Äî <b>üêù</b></footer>
  </div>

  <button id="pill" class="pillToggle" type="button" aria-pressed="false" aria-label="Toggle Honey 128 Hz">üçØ <span id="pillTxt">Honey</span></button>
  <audio id="pipe" preload="auto" playsinline style="position:fixed;left:-9999px;top:-9999px;width:1px;height:1px;opacity:0"></audio>

<script>
(function(){
  const ProAudio = {
    ctx:null, master:null, comp:null, hpf:null, usePipe:false, pipe:document.getElementById('pipe'),
    nodes:new Set(), unlocked:false, starting:false,
    ensure(){
      if(this.ctx) return this.ctx;
      const AC = window.AudioContext||window.webkitAudioContext;
      this.ctx = new AC({latencyHint:'interactive'});
      this.master = this.ctx.createGain(); this.master.gain.value = 0.85;
      this.comp = this.ctx.createDynamicsCompressor();
      this.comp.threshold.value=-18; this.comp.knee.value=12; this.comp.ratio.value=2; this.comp.attack.value=.01; this.comp.release.value=.30;
      this.hpf = this.ctx.createBiquadFilter(); this.hpf.type='highpass'; this.hpf.frequency.value=18;
      const iOS = /iP(hone|ad|od)/.test(navigator.userAgent||'');
      if(iOS){
        this.usePipe = true;
        const msd = this.ctx.createMediaStreamDestination();
        this.master.connect(this.comp); this.comp.connect(this.hpf); this.hpf.connect(msd);
        try{ this.pipe.srcObject = msd.stream; this.pipe.loop = true; }catch(_){}
      }else{
        this.master.connect(this.comp); this.comp.connect(this.hpf); this.hpf.connect(this.ctx.destination);
      }
      return this.ctx;
    },
    unlock(){
      try{
        this.ensure();
        if(this.ctx && this.ctx.state==='suspended'){ this.ctx.resume(); }
        if(this.usePipe && this.pipe && this.pipe.paused){ this.pipe.play().catch(()=>{}); }
        this.unlocked = true;
      }catch(_){}
    },
    track(obj){ if(obj) this.nodes.add(obj); return obj; },
    fade(param, to, tc=0.06){
      const t=this.ctx.currentTime; try{ param.cancelScheduledValues(t); param.setTargetAtTime(to, t, tc); }catch(_){}
    },
    kill(){
      try{
        if(!this.ctx) return;
        const t = this.ctx.currentTime;
        this.nodes.forEach(n=>{
          try{
            if(n.g && n.g.gain){ n.g.gain.setTargetAtTime(0.0001, t, 0.05); }
            if(n.stop){ n.stop(t+0.12); }
          }catch(_){}
        });
        this.nodes.clear();
        setTimeout(()=>{ try{ this.ctx.close(); }catch(_){} this.ctx=null; this.unlocked=false; }, 180);
      }catch(_){}
    },
    honey:{
      osc:null, gain:null, on:false,
      start(freq=128){
        const PA=ProAudio; if(PA.starting) return; PA.starting=true; setTimeout(()=>PA.starting=false, 160);
        PA.unlock(); PA.ensure();
        if(this.on) return;
        const now=PA.ctx.currentTime;
        this.osc = PA.ctx.createOscillator(); this.gain= PA.ctx.createGain();
        this.osc.type='sine'; this.osc.frequency.setValueAtTime(freq, now);
        this.gain.gain.setValueAtTime(0.0001, now);
        this.osc.connect(this.gain); this.gain.connect(PA.master);
        try{ this.osc.start(now); }catch(_){}
        PA.fade(this.gain.gain, 0.12, 0.10);
        this.on=true;
        PA.track({ stop:(t)=>{ try{ this.osc && this.osc.stop(t); }catch(_){ } }, g:this.gain });
        return true;
      },
      stop(){
        const PA=ProAudio; if(!this.on || !PA.ctx) return;
        const now=PA.ctx.currentTime;
        try{
          PA.fade(this.gain.gain, 0.0001, 0.06);
          setTimeout(()=>{ try{ this.osc.stop(now+0.02); }catch(_){}
            try{ this.osc.disconnect(); this.gain.disconnect(); }catch(_){}
            this.osc=null; this.gain=null; this.on=false;
          }, 220);
        }catch(_){ this.on=false; }
      },
      volume(x){ const PA=ProAudio; if(!this.gain||!PA.ctx) return; const v=Math.max(0,Math.min(1,Number(x)||0)); PA.fade(this.gain.gain, v*0.30, 0.05); }
    }
  };
  window.ProAudio = ProAudio;

  document.addEventListener('pointerdown', ()=>ProAudio.unlock(), {once:true, passive:true});
  document.addEventListener('keydown', ()=>ProAudio.unlock(), {once:true});
  document.addEventListener('visibilitychange', ()=>{ if(document.hidden) ProAudio.kill(); }, false);
  window.addEventListener('pagehide', ()=>ProAudio.kill(), false);
  window.addEventListener('beforeunload', ()=>ProAudio.kill(), false);
})();

(function(){
  const startBtn=document.getElementById('hStart');
  const stopBtn =document.getElementById('hStop');
  const vol     =document.getElementById('hVol');
  const pill    =document.getElementById('pill');
  const pillTxt =document.getElementById('pillTxt');

  function syncPill(){ pill.setAttribute('aria-pressed', String(!!(ProAudio.honey && ProAudio.honey.on))); pillTxt.textContent = ProAudio.honey.on ? 'On' : 'Honey'; }
  function start(){ if(ProAudio.honey.start(128)){ syncPill(); } }
  function stop(){ ProAudio.honey.stop(); syncPill(); }
  function setVol(){ const v = Number(vol.value||28); ProAudio.honey.volume(v/100); }

  startBtn.addEventListener('click', start, false);
  stopBtn .addEventListener('click', stop,  false);
  vol     .addEventListener('input', setVol, false);
  pill.addEventListener('click', ()=>{ ProAudio.honey.on ? stop() : start(); }, false);

  syncPill(); setVol();
})();

(function(){
  const share = document.getElementById('shareX');
  const ics   = document.getElementById('ics');

  function buildShare(){
    const msg = "No Kings Day ‚Äî Oct 18, NYC. Marina √ó Sabrina √ó Doechii on SNL. Join us.";
    const url = location.href;
    const u = "https://twitter.com/intent/tweet?text="+encodeURIComponent(msg)+"&url="+encodeURIComponent(url)+"&hashtags=NoKingsDay,NYC";
    share.setAttribute('href', u);
  }
  function buildICS(){
    const now = new Date();
    const dtstamp = now.toISOString().replace(/[-:]/g,'').replace(/\.\d{3}Z$/,'Z');
    const icsText = [
      "BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//PLNT Earth//No Kings Day//EN","CALSCALE:GREGORIAN","METHOD:PUBLISH","X-WR-CALNAME:No Kings Day","X-WR-TIMEZONE:America/New_York",
      "BEGIN:VEVENT",
      "UID:nkd-20251018-"+Date.now()+"@plnt.earth",
      "DTSTAMP:"+dtstamp,
      "SUMMARY:No Kings Day ‚Äî NYC",
      "DESCRIPTION:Marina √ó Sabrina √ó Doechii on SNL. Join in NYC ‚Üí https://jar.plnt.earth",
      "DTSTART;VALUE=DATE:20251018",
      "DTEND;VALUE=DATE:20251019",
      "URL:https://jar.plnt.earth",
      "END:VEVENT","END:VCALENDAR"
    ].join("\r\n");
    ics.setAttribute('href', "data:text/calendar;charset=utf-8,"+encodeURIComponent(icsText));
  }
  function two(n){ return (n<10?'0':'')+n; }
  const target = new Date("2025-10-18T00:00:00-04:00").getTime();
  const box = document.getElementById('countTxt');
  function tick(){
    const now = Date.now();
    let diff = Math.max(0, target - now);
    const d = Math.floor(diff/86400000); diff%=86400000;
    const h = Math.floor(diff/3600000);  diff%=3600000;
    const m = Math.floor(diff/60000);    diff%=60000;
    const s = Math.floor(diff/1000);
    box.textContent = d+"d "+two(h)+"h "+two(m)+"m "+two(s)+"s";
  }
  buildShare(); buildICS(); tick();
  setInterval(tick, 1000);
})();

(function(){
  const tempos = { root:1, architect:1, mirror:1 };
  const status = {
    root: document.getElementById('status-root'),
    architect: document.getElementById('status-architect'),
    mirror: document.getElementById('status-mirror')
  };
  function setTempo(key, v){
    const x=Math.max(0.5,Math.min(1.5,Number(v)||1));
    tempos[key]=x;
    const s=status[key]; if(s) s.textContent="tempo √ó"+x.toFixed(2);
  }
  ['root','architect','mirror'].forEach(k=>{
    const el=document.getElementById('tempo-'+k);
    if(el) el.addEventListener('input', e=>setTempo(k, e.target.value), false);
  });

  const seq = {
    root: ()=>[
      {freq:128, dur:3.2, amp:0.16}, {rest:0.6},
      {freq: 96, dur:2.4, amp:0.16}, {rest:0.5},
      {freq:160, dur:2.8, amp:0.16}, {rest:0.8},
      {freq:128, dur:3.6, amp:0.16}, {rest:0.7},
      {freq: 96, dur:2.2, amp:0.16}, {rest:0.6},
      {freq:128, dur:3.0, amp:0.16}
    ],
    architect: ()=>[
      {freq:330, dur:0.9, amp:0.18}, {rest:0.3},
      {freq:392, dur:0.9, amp:0.18}, {rest:0.3},
      {freq:440, dur:0.9, amp:0.18}, {rest:0.3},
      {freq:392, dur:0.9, amp:0.18}, {rest:0.5},
      {freq:330, dur:1.2, amp:0.18}, {rest:0.6},
      {freq:392, dur:1.2, amp:0.18}
    ],
    mirror: ()=>[
      {freq:660, dur:1.6, amp:0.14}, {rest:1.0},
      {freq:880, dur:1.2, amp:0.14}, {rest:1.4},
      {freq:740, dur:1.4, amp:0.14}, {rest:1.2},
      {freq:880, dur:1.0, amp:0.14}, {rest:1.6},
      {freq:660, dur:1.8, amp:0.14}
    ]
  };

  let active = null; // {timer, nodes:[{o,g}], key}

  function stopPlaylist(){
    if(!active){ return; }
    if(active.timer){ clearTimeout(active.timer); active.timer=0; }
    const PA=ProAudio; if(!PA.ctx) { active=null; return; }
    const now=PA.ctx.currentTime;
    if(active.nodes){
      active.nodes.forEach(n=>{
        try{
          if(n.g){ n.g.gain.cancelScheduledValues(now); n.g.gain.setValueAtTime(n.g.gain.value, now); n.g.gain.setTargetAtTime(0.0001, now, 0.05); }
          if(n.stop){ n.stop(now+0.12); }
        }catch(_){}
      });
    }
    if(status[active.key]) status[active.key].textContent='‚Äî';
    active=null;
  }

  function playPlaylist(key){
    stopPlaylist();
    const PA=ProAudio; PA.unlock(); PA.ensure();
    const scale = tempos[key] || 1;
    const steps = seq[key](); const nodes=[];
    const now = PA.ctx.currentTime + 0.02;
    let t = now;

    steps.forEach(step=>{
      if(step.rest){ t += Math.max(0.08, step.rest/scale); return; }
      const o = PA.ctx.createOscillator();
      const g = PA.ctx.createGain();
      o.type='sine';
      o.frequency.setValueAtTime(step.freq, t);
      g.gain.setValueAtTime(0.0, t);
      const on = Math.max(0.04, Math.min(0.22, step.dur/scale*0.12));
      g.gain.linearRampToValueAtTime(step.amp||0.18, t+on);
      g.gain.setValueAtTime(step.amp||0.18, t+Math.max(0.04, (step.dur/scale)-0.10));
      g.gain.linearRampToValueAtTime(0.0005, t+Math.max(0.05, (step.dur/scale)));
      o.connect(g); g.connect(PA.master);
      try{ o.start(t); }catch(_){}
      const stopAt = t + (step.dur/scale) + 0.02;
      try{ o.stop(stopAt); }catch(_){}
      PA.track({ stop:(tt)=>{ try{ o.stop(tt); }catch(_){ } }, g:g });
      nodes.push({o,g});
      t += Math.max(0.08, step.dur/scale);
    });

    active = {key, nodes, timer:0};
    if(status[key]) status[key].textContent="playing‚Ä¶";
    active.timer = setTimeout(()=>{ if(status[key]) status[key].textContent='‚Äî'; active=null; }, Math.max(50, (t-now)*1000 + 80));
  }

  document.querySelectorAll('[data-play]').forEach(b=>{
    b.addEventListener('click', ()=>playPlaylist(b.getAttribute('data-play')), false);
  });
  document.querySelectorAll('[data-stop]').forEach(b=>{
    b.addEventListener('click', stopPlaylist, false);
  });

  window.addEventListener('beforeunload', stopPlaylist, false);
})();

(function(){
  const KEY='tunes_bee_note_v2'; const text=document.getElementById('bee-text');
  function def(){ return "Hi Sabrina ‚Äî pick the lane that feels kind. Root to arrive, Architect to focus, Mirror to reflect. If your chest asks for quiet, we pause. You are safe, guided, and loved."; }
  try{ const saved=localStorage.getItem(KEY)||""; text.textContent = saved.trim()? saved : def(); }catch(_){ text.textContent = def(); }
  document.getElementById('beeEdit').addEventListener('click', ()=>{ text.setAttribute('contenteditable','true'); text.focus(); }, false);
  document.getElementById('beeSave').addEventListener('click', ()=>{ text.setAttribute('contenteditable','false'); try{ localStorage.setItem(KEY,(text.textContent||'').trim()); }catch(_){ } whisper("Saved with love.", 2600); }, false);
  document.getElementById('beeReset').addEventListener('click', ()=>{ text.textContent=def(); text.setAttribute('contenteditable','false'); try{ localStorage.setItem(KEY, text.textContent); }catch(_){ } whisper("Back to the gentle original.", 2600); }, false);
  function whisper(msg, ms){
    let el=document.getElementById('bee-footer'); if(!el){ el=document.createElement('div'); el.id='bee-footer'; el.className='bee-footer'; el.setAttribute('role','status'); el.setAttribute('aria-live','polite'); document.body.appendChild(el); }
    el.textContent='üêù '+msg; el.classList.add('on'); setTimeout(()=>{ el.classList.remove('on'); }, ms||2600);
  }
})();

</script>
</body>
</html>
