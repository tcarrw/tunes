<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>tunes.plnt.earth — Illumina 1</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' fill='%230b0b0c'/><circle cx='50' cy='50' r='40' fill='%23e9e9ef'/><circle cx='42' cy='50' r='34' fill='%230b0b0c'/></svg>">
  <style>
    :root { --bg:#0b0b0c; --card:#141417; --text:#e9e9ef; --muted:#9a9aab; --accent:#b2f5ea; --ring:#2a2a33; --chip:#23232a; }
    [data-theme="neon"] { --accent:#00e5ff; --card:#11131a; --chip:#151823; }
    [data-theme="honey"] { --accent:#ffd166; --card:#1a1511; --chip:#221a13; }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{background:var(--card);border-bottom:1px solid var(--ring);position:sticky;top:0;z-index:10}
    nav{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;flex-wrap:wrap;gap:16px;align-items:center}
    nav a{text-decoration:none;color:var(--text);font-size:14px}
    nav a:hover{color:var(--accent)}
    .mode{margin-left:auto;display:flex;gap:8px}
    .btn{display:inline-block;border:1px solid var(--ring);border-radius:10px;padding:6px 10px;color:var(--text);text-decoration:none;background:none;cursor:pointer;font-size:13px}
    .btn:hover{border-color:var(--accent);color:var(--accent)}
    main{max-width:1200px;margin:0 auto;padding:20px 16px}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:16px}
    @media (max-width:980px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--ring);border-radius:16px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,.35)}
    h1{margin:8px 0 4px}
    .meta{color:var(--muted);margin-bottom:12px}
    input[type="search"], select{background:#0e0e11;color:var(--text);border:1px solid var(--ring);border-radius:10px;padding:8px 10px;width:100%}
    .list{display:flex;flex-direction:column;gap:8px;max-height:560px;overflow:auto}
    .row{display:flex;gap:10px;align-items:center;justify-content:space-between;border:1px solid var(--ring);border-radius:12px;padding:10px 12px;background:var(--chip)}
    .row .day{font-weight:700;min-width:36px;text-align:center}
    .row .fig{color:var(--muted);font-size:12px}
    .row .open{white-space:nowrap;display:flex;gap:8px}
    iframe{width:100%;aspect-ratio:16/9;border:1px solid var(--ring);border-radius:12px;background:#000}
    footer{color:var(--muted);text-align:center;padding:20px 0;font-size:13px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .now{margin-top:8px;color:var(--muted);font-size:12px}
  </style>
</head>
<body>
  <header>
    <nav>
      <a href="/">Tunes</a>
      <a href="https://jar.plnt.earth/calendar/illumina1/" target="_blank">Jar Calendar ↗</a>
      <a href="https://jar.plnt.earth/pantheon/" target="_blank">Pantheon ↗</a>
      <a href="https://jar.plnt.earth/references/" target="_blank">References ↗</a>
      <a href="https://youtube.com/playlist?list=PL2H7n7qLAdf7VTOrmFlY9G-PaE94VrHAY&si=vblXKmAvTj-Ve5iV" target="_blank">Playlist ↗</a>
      <div class="mode">
        <button class="btn" data-set-theme="classic">Classic</button>
        <button class="btn" data-set-theme="neon">Neon</button>
        <button class="btn" data-set-theme="honey">Honey</button>
      </div>
    </nav>
  </header>

  <main>
    <h1>Illumina 1 — Tunes</h1>
    <div class="meta">YouTube playlist + daily tracks. Use the list to jump; use Jar for full day context.</div>

    <div class="grid">
      <div class="card">
        <div id="player"></div>
        <div id="now" class="now"></div>
      </div>
      <div class="card">
        <div class="controls">
          <input id="q" type="search" placeholder="Search track / figure…" />
          <select id="fig"></select>
        </div>
        <div class="list" id="list"></div>
      </div>
    </div>
  </main>

  <footer>© tunes.plnt.earth</footer>

  <script>
    const DATA_URL = "/data/illumina1.json"; // place the JSON in this repo under /data/
    const PLAYLIST = "https://www.youtube.com/embed/videoseries?list=PL2H7n7qLAdf7VTOrmFlY9G-PaE94VrHAY";
    const JAR = "https://jar.plnt.earth";
    const THEME_KEY = "tunes:theme";

    function ytid(url){
      try{
        if(!url) return null;
        const u = new URL(url);
        if(u.hostname.includes("youtube.com")){
          const v = u.searchParams.get("v");
          if(v) return v;
          return null;
        }
        if(u.hostname.includes("youtu.be")){
          const parts = u.pathname.split("/").filter(Boolean);
          return parts[0] || null;
        }
      }catch(e){}
      return null;
    }

    function embedPlayer(videoId, label){
      const wrap = document.getElementById("player");
      const iframe = document.createElement("iframe");
      iframe.setAttribute("allowfullscreen","");
      iframe.setAttribute("title","YouTube player");
      iframe.src = videoId ? ("https://www.youtube.com/embed/" + videoId) : PLAYLIST;
      wrap.innerHTML = "";
      wrap.appendChild(iframe);
      document.getElementById("now").textContent = label || (videoId ? "" : "Playing: Playlist");
    }

    function populateFigures(data){
      const sel = document.getElementById("fig");
      sel.innerHTML = "";
      const o0 = document.createElement("option"); o0.value=""; o0.textContent="All figures"; sel.appendChild(o0);
      Array.from(new Set(data.map(d=>d.Figure).filter(Boolean))).sort().forEach(f=>{
        const o = document.createElement("option"); o.value=f; o.textContent=f; sel.appendChild(o);
      });
    }

    function renderList(data){
      const q = (document.getElementById("q").value||"").toLowerCase();
      const fig = document.getElementById("fig").value;
      const box = document.getElementById("list");
      const filtered = data.filter(d=>{
        const hay = (String(d.Track) + " " + String(d.Figure)).toLowerCase();
        const okQ = !q || hay.indexOf(q) !== -1;
        const okF = !fig || d.Figure===fig;
        return okQ && okF;
      }).sort((a,b)=>a.Day-b.Day);
      box.innerHTML = "";
      filtered.forEach(d=>{
        const row = document.createElement("div"); row.className="row";
        row.innerHTML = '<div class="day">'+d.Day+'</div>' +
          '<div><div>'+d.Track+'</div><div class="fig">'+(d.Figure||"")+'</div></div>' +
          '<div class="open">' +
            '<a class="btn" href="#" data-day="'+d.Day+'">Play</a>' +
            '<a class="btn" href="'+JAR+'/day/?n='+d.Day+'" target="_blank">Open Day ↗</a>' +
          '</div>';
        row.querySelector('a[data-day]').addEventListener('click', (ev)=>{
          ev.preventDefault();
          const id = ytid(d.URL);
          embedPlayer(id, "Playing: Day "+d.Day+" — "+d.Track);
          history.replaceState(null, "", "?n="+d.Day);
        });
        box.appendChild(row);
      });
    }

    function applyTheme(theme){
      const root = document.documentElement;
      if(theme && theme !== "classic"){
        root.setAttribute("data-theme", theme);
      }else{
        root.removeAttribute("data-theme");
        theme = "classic";
      }
      try{ localStorage.setItem(THEME_KEY, theme); }catch(e){}
    }

    async function boot(){
      // Theme: restore + buttons
      try{
        const saved = localStorage.getItem(THEME_KEY);
        if(saved) applyTheme(saved);
      }catch(e){}
      document.querySelectorAll("[data-set-theme]").forEach(btn=>{
        btn.addEventListener("click", ()=>applyTheme(btn.getAttribute("data-set-theme")));
      });

      // Load data
      try{
        const res = await fetch(DATA_URL);
        const data = await res.json();
        populateFigures(data);
        renderList(data);
        // Deep-link support
        const qp = new URLSearchParams(location.search);
        const v = qp.get("v");
        const n = parseInt(qp.get("n")||"", 10);
        const fig = qp.get("fig");
        const q = qp.get("q");
        if(fig){ document.getElementById("fig").value = fig; }
        if(q){ document.getElementById("q").value = q; }
        if(v){
          embedPlayer(v, "Playing: custom video");
        }else if(!isNaN(n)){
          const entry = data.find(d => +d.Day === n);
          const id = entry ? ytid(entry.URL) : null;
          embedPlayer(id, entry ? ("Playing: Day "+entry.Day+" — "+entry.Track) : null);
        }else{
          embedPlayer(null);
        }
        document.getElementById("q").addEventListener("input", ()=>renderList(data));
        document.getElementById("fig").addEventListener("change", ()=>renderList(data));
      }catch(e){
        document.getElementById("player").textContent = "Error loading /data/illumina1.json";
      }
    }
    boot();
  </script>
</body>
</html>
