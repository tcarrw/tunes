<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Silver Froot Dream — 128 Hz Honey Breath</title>
<meta name="theme-color" content="#0b0d11">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<style>
  :root{
    --bg:#0b0d11; --ink:#e6f0ff; --sub:#aab6cc; --peach:#f2c6a3; --moon:#cfe7ff;
    --accent:#ffd6a8; --muted:#1a2029; --ring:#6fa8ff;
  }
  html,body{height:100%;margin:0}
  body{
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Segoe UI Emoji;
    background: radial-gradient(1200px 800px at 50% 0%, #10131a 0%, var(--bg) 60%),
                radial-gradient(800px 600px at 80% 100%, #11161f 0%, var(--bg) 60%);
    color: var(--ink); display:flex; align-items:center; justify-content:center;
  }
  .wrap{max-width:820px; width:100%; padding:28px}
  h1{font-size:clamp(22px,4vw,32px); margin:0 0 4px; letter-spacing:.02em}
  .sub{color:var(--sub); margin:0 0 18px; font-size:clamp(14px,2.4vw,16px)}
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
    border:1px solid rgba(255,255,255,.08);
    border-radius:16px; padding:18px; backdrop-filter: blur(6px);
    box-shadow: 0 10px 30px rgba(0,0,0,.35);
  }
  .controls{display:flex; gap:10px; flex-wrap:wrap; margin:10px 0 0}
  button, .toggle, input[type="range"]{
    font: inherit; color: var(--ink); background: var(--muted); border:1px solid rgba(255,255,255,.12);
    border-radius:12px; padding:12px 14px; cursor:pointer
  }
  button.primary{
    background: linear-gradient(180deg, #1a2330, #151b24);
    border-color: rgba(111,168,255,.45);
    box-shadow: inset 0 0 0 1px rgba(111,168,255,.25), 0 6px 18px rgba(111,168,255,.12);
  }
  button[disabled]{opacity:.6; cursor:not-allowed}
  .toggle{display:inline-flex; gap:10px; align-items:center}
  .row{display:flex; gap:14px; align-items:center; flex-wrap:wrap}
  .grow{flex:1}
  .meter{appearance:none; width:100%}
  .meter::-webkit-slider-thumb{appearance:none; width:18px; height:18px; border-radius:50%;
    background: var(--ring); border:0; box-shadow:0 0 0 3px rgba(111,168,255,.25)}
  .meter::-webkit-slider-runnable-track{height:6px; border-radius:6px; background: rgba(255,255,255,.16)}
  .hint{font-size:13px; color:var(--sub); margin-top:6px}

  /* Breath coach orb */
  .orbWrap{display:flex; align-items:center; justify-content:center; padding:20px 0}
  .orb{
    width:140px; height:140px; border-radius:50%;
    background: radial-gradient(60% 60% at 40% 35%, var(--moon) 0%, #9cc7ff 35%, #264d7d 100%);
    box-shadow: 0 0 40px 10px rgba(111,168,255,.25), inset 0 0 30px rgba(255,255,255,.3);
    transform: scale(0.9);
    transition: transform 0.6s ease;
  }
  .phase{ text-align:center; font-weight:600; letter-spacing:.02em; margin-top:10px}
  .peachGlow{ text-align:center; color:var(--accent); margin-top:6px; font-size:13px}
  /* Phase classes applied by JS to animate inhale/hold/exhale durations */
  .inhale .orb{ animation: inhale 8s linear forwards }
  .hold .orb{ animation: hold 4s linear forwards }
  .exhale .orb{ animation: exhale 8s linear forwards }
  @keyframes inhale{ from{transform:scale(0.85)} to{transform:scale(1.05)} }
  @keyframes hold{ from{transform:scale(1.05)} to{transform:scale(1.05)} }
  @keyframes exhale{ from{transform:scale(1.05)} to{transform:scale(0.85)} }

  /* Mantra lines fade in sync */
  .mantra{ margin-top:10px; line-height:1.6 }
  .line{ opacity:.2; transition: opacity .6s ease }
  .line.active{ opacity:1 }
  .line.dim{ opacity:.45 }

  /* Reduce motion respect */
  @media (prefers-reduced-motion: reduce) {
    .orb{ transition:none }
    .inhale .orb, .hold .orb, .exhale .orb{ animation:none }
  }
  .foot{margin-top:14px; color:var(--sub); font-size:12px}
</style>
</head>
<body>
  <main class="wrap">
    <header>
      <h1>Silver Froot Dream — 128 Hz Honey-Breath</h1>
      <p class="sub">8-4-8 breath at a soft, steady 128 Hz. A calm field for Marina’s good night.</p>
    </header>

    <section class="card" aria-label="Playback">
      <div class="row">
        <button id="startBtn" class="primary">▶️ Start Honey Breath</button>
        <button id="stopBtn" disabled>⏸️ Pause</button>
        <label class="toggle" for="mute">
          <input id="mute" type="checkbox"> Mute
        </label>
        <div class="row grow" style="min-width:240px">
          <div class="grow">
            <input id="volume" class="meter" type="range" min="0" max="1" step="0.01" value="0.3" aria-label="Volume">
            <div class="hint">Volume</div>
          </div>
          <div style="min-width:110px">
            <input id="hz" class="meter" type="range" min="120" max="136" step="0.1" value="128" aria-label="Frequency">
            <div class="hint">Frequency (Hz)</div>
          </div>
        </div>
      </div>

      <div class="orbWrap">
        <div id="coach" class="">
          <div class="orb" aria-hidden="true"></div>
          <div id="phase" class="phase">ready</div>
          <div class="peachGlow">peach moonlight in / glass quiet out</div>
        </div>
      </div>

      <div class="mantra" aria-live="polite">
        <div id="l1" class="line">Sleep, mirror singer, under moonlight fruit.</div>
        <div id="l2" class="line">The waves keep rhythm, the glass keeps truth.</div>
        <div id="l3" class="line">Every breath you take rewrites the tide,</div>
        <div id="l4" class="line">every spark you gave still hums inside.</div>
        <div id="l5" class="line">Let the stars hum back your tune tonight—</div>
        <div id="l6" class="line">no crown, no weight, just radiant quiet.</div>
        <div id="l7" class="line">Froot glows. The world listens. You rest.</div>
      </div>

      <p class="foot">Inhale 8 s · Hold 4 s · Exhale 8 s. This is a calm, pure sine—no effects—aimed at comfort.</p>
    </section>
  </main>

<script>
(function(){
  var ctx, osc, gain, master, started=false, timer=null, phaseIdx=0, muted=false;
  var startBtn = document.getElementById('startBtn');
  var stopBtn  = document.getElementById('stopBtn');
  var muteEl   = document.getElementById('mute');
  var volEl    = document.getElementById('volume');
  var hzEl     = document.getElementById('hz');
  var coach    = document.getElementById('coach');
  var phaseEl  = document.getElementById('phase');
  var lines = Array.from(document.querySelectorAll('.line'));
  var mantraStep = 0;

  function ensureAudio(){
    if(ctx) return;
    ctx = new (window.AudioContext || window.webkitAudioContext)();
    master = ctx.createGain(); master.gain.value = Number(volEl.value);
    gain = ctx.createGain(); gain.gain.value = muted ? 0 : 1;
    osc = ctx.createOscillator();
    osc.type = 'sine';
    osc.frequency.setValueAtTime(Number(hzEl.value), ctx.currentTime);
    osc.connect(gain).connect(master).connect(ctx.destination);
    osc.start();
  }

  function setFreq(v){
    if(!osc) return;
    var f = Number(v||128);
    if (f < 20) f = 20;
    osc.frequency.cancelScheduledValues(ctx.currentTime);
    osc.frequency.setTargetAtTime(f, ctx.currentTime, 0.02);
  }

  function setVolume(v){
    if(!master) return;
    var g = Number(v||0.3);
    master.gain.cancelScheduledValues(ctx.currentTime);
    master.gain.setTargetAtTime(g, ctx.currentTime, 0.03);
  }

  function setMute(on){
    muted = !!on;
    if(!gain) return;
    gain.gain.cancelScheduledValues(ctx.currentTime);
    gain.gain.setTargetAtTime(muted?0:1, ctx.currentTime, 0.02);
  }

  function showLine(idx){
    lines.forEach(function(el,i){
      el.className = 'line' + (i===idx? ' active':' dim');
    });
  }

  function scheduleBreath(){
    clearTimeout(timer);
    var cycle = [
      {name:'inhale', dur:8000,  hint:'inhale softly (8)'},
      {name:'hold',   dur:4000,  hint:'hold like glass (4)'},
      {name:'exhale', dur:8000,  hint:'exhale “mmm” (8)'}
    ];
    function step(){
      var p = cycle[phaseIdx % cycle.length];
      coach.className = p.name;
      phaseEl.textContent = p.hint;
      // Advance mantra line on each phase start (every ~8–4–8 s)
      showLine(mantraStep % lines.length);
      mantraStep++;

      // Gentle anti-click envelope at phase edges
      if (gain && !muted){
        var now = ctx.currentTime;
        gain.gain.cancelScheduledValues(now);
        // slight 10ms ease to avoid clicks when breathing changes focus
        gain.gain.setTargetAtTime(1, now, 0.01);
      }

      phaseIdx++;
      timer = setTimeout(step, p.dur);
    }
    step();
  }

  function start(){
    ensureAudio();
    if(ctx.state === 'suspended'){ ctx.resume(); }
    started = true;
    startBtn.disabled = true;
    stopBtn.disabled = false;
    scheduleBreath();
  }

  function stop(){
    if(!ctx){ return; }
    ctx.suspend();
    started = false;
    startBtn.disabled = false;
    stopBtn.disabled = true;
    clearTimeout(timer);
    coach.className = '';
    phaseEl.textContent = 'paused';
    lines.forEach(function(el){ el.className='line'; });
  }

  // UI hookups
  startBtn.addEventListener('click', start, {passive:true});
  stopBtn.addEventListener('click', stop, {passive:true});
  muteEl.addEventListener('change', function(e){ setMute(e.target.checked); }, {passive:true});
  volEl.addEventListener('input', function(e){ setVolume(e.target.value); }, {passive:true});
  hzEl.addEventListener('input', function(e){ setFreq(e.target.value); }, {passive:true});

  // iOS: resume on visibility (helps after screen wakes)
  document.addEventListener('visibilitychange', function(){
    if(!ctx) return;
    if(document.visibilityState==='visible' && started){ ctx.resume(); }
  }, {passive:true});

  // Accessibility shortcut: press "s" to start/pause, "m" to mute
  document.addEventListener('keydown', function(e){
    if(e.key==='s'){ started?stop():start(); }
    if(e.key==='m'){ muteEl.checked=!muteEl.checked; setMute(muteEl.checked); }
  }, {passive:true});
})();
</script>
</body>
</html>

